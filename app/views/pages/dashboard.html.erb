<% content_for(:title) do %>
  Flattrack | Dashboard
<% end %>
<%= render 'shared/taskModal' %>
<div class="container">
  <!--<h2 class="header">Good Morning, <%= current_user.name %>!</h2>-->
  <div class="d-flex justify-content-between px-3">
    <span>

    <h2 class="header">Tasks for today (<%= @tasks.count %>)</h2>
    <button style="position:sticky; bottom:10px; right:80px;" type="button" class="button-dark-dashboard">
     <i class="fas fa-plus"></i> &nbsp;New Task
      </button>
    </span>

  </div>
  <div class="dashboard-container">
    <div class="task-feed-container">
      <h3 style="border-bottom: thin solid red;">High Priority</h3>
      <%@top_prio.each do |task|%>
        <div class="task-card-feed">
          <div class="row">
            <div class="card-top">
            <p class="lighter grey-out">
              <%if task.category.name.downcase =="repair"%>
                <img src="icon_task_category_repair.png" alt="" style="rgba(0,0,0,0.7)">
              <% elsif task.category.name.downcase =="maintenance"%>
                <img src="icon_task_category_maintenance.png" alt="" style="color:rgba(0,0,0,0.7)">
              <% elsif task.category.name.downcase =="restocking"%>
                <img src="icon_task_category_restocking.png" alt="" style="color:rgba(0,0,0,0.7)">
              <% elsif task.category.name.downcase =="furnishing"%>
                <img src="icon_task_category_furnishing.png" alt="" style="color:rgba(0,0,0,0.7)">
              <%else%>
                <img src="icon_task_category_general.png" alt="" style="color:rgba(0,0,0,0.7)">
              <%end%>
                 &nbsp; <%=task.category.name%></p>
              <h3>
                <%=task.title%>

                </h3>


              </div>
              <div class="task-avatar">
                <%= cl_image_tag task.user.photo, crop: :thumb, class: "avatar" %>
                <p><%=task.created_at.strftime("%e %b")%></p>
           </div>
        </div>
        </div>
      <%end%>
      <h3 style="border-bottom: thin solid orange;">Medium Priority</h3>
            <%@med_prio.each do |task|%>
        <div class="task-card-feed">
          <div class="row">
            <div class="card-top" style="display:grid; flex-direction:column;">
            <p class="lighter grey-out">
              <%if task.category.name.downcase =="repair"%>
                <img src="icon_task_category_repair.png" alt="" style="rgba(0,0,0,0.7)">
              <% elsif task.category.name.downcase =="maintenance"%>
                <img src="icon_task_category_maintenance.png" alt="" style="color:rgba(0,0,0,0.7)">
              <% elsif task.category.name.downcase =="restocking"%>
                <img src="icon_task_category_restocking.png" alt="" style="color:rgba(0,0,0,0.7)">
              <% elsif task.category.name.downcase =="furnishing"%>
                <img src="icon_task_category_furnishing.png" alt="" style="color:rgba(0,0,0,0.7)">
              <%else%>
                <img src="icon_task_category_general.png" alt="" style="color:rgba(0,0,0,0.7)">
              <%end%>
                 &nbsp; <%=task.category.name%></p>
              <h3>
              <%=task.title%>
                </h3>
              </div>
              <div class="task-avatar">
                <%= cl_image_tag task.user.photo, crop: :thumb, class: "avatar" %>
                <p><%=task.created_at.strftime("%e %b")%></p>
           </div>
        </div>
        </div>
      <%end%>
      <h3 style="border-bottom: thin solid green;">Low Priority</h3>
      <%@low_prio.each do |task|%>
        <div class="task-card-feed">
          <div class="row">
            <div class="card-top" style="display:grid; flex-direction:column;">
            <p class="lighter grey-out">
              <%if task.category.name.downcase =="repair"%>
                <img src="icon_task_category_repair.png" alt="" style="rgba(0,0,0,0.7)">
              <% elsif task.category.name.downcase =="maintenance"%>
                <img src="icon_task_category_maintenance.png" alt="" style="color:rgba(0,0,0,0.7)">
              <% elsif task.category.name.downcase =="restocking"%>
                <img src="icon_task_category_restocking.png" alt="" style="color:rgba(0,0,0,0.7)">
              <% elsif task.category.name.downcase =="furnishing"%>
                <img src="icon_task_category_furnishing.png" alt="" style="color:rgba(0,0,0,0.7)">
              <%else%>
                <img src="icon_task_category_general.png" alt="" style="color:rgba(0,0,0,0.7)">
              <%end%>
                 &nbsp; <%=task.category.name%></p>
              <h3>
                <%=task.title%>
                </h3>
              </div>
              <div class="task-avatar">
                <%= cl_image_tag task.user.photo, crop: :thumb, class: "avatar" %>
                <p><%=task.created_at.strftime("%e %b")%></p>
           </div>
        </div>
        </div>
      <%end%>
    </div>


    <div class="item-a item-padding">
      <div class="dashboard-card-regular">
        <h3 class="dashboard-kpis"><%= @area %>m²</h3>
        <h3 class="title subheader">Area</h3>
      </div>
    </div>
    <div class="item-b item-padding">
      <div class="dashboard-card-regular">
        <h3 class="dashboard-kpis"><%= @rent * Flat.count / @area %>€/m²</h3>
        <h3 class="title subheader">Rent</h3>
      </div>
    </div>
    <div class="item-c item-padding">
      <div class="dashboard-card-regular">
        <h3 class="dashboard-kpis utilities"><%= @utilities %>€</h3>
        <h3 class="title subheader">Utilities</h3>
      </div>
    </div>
    <div class="item-d item-padding">
      <div class="dashboard-card-regular">
        <h3 class="dashboard-kpis cashflow"><%= @cashflow %>€</h3>
        <h3 class="title subheader">Cash Flow</h3>
      </div>
    </div>
    <div class="item-e item-padding">
      <div class="dashboard-card-regular">
       <h3 class="title subheader">Workload</h3>
        <%= pie_chart(@users, messages: {empty: "No data"}, library:{backgroundColor: "#FFFFFF"},width: "250px", height: "230px") %>

        <!--<%= pie_chart User.where(company:current_user.company).map { |user| {name: user.name, data: user.tasks.length}}%>-->
      </div>
    </div>
    <div class="item-f item-padding">
      <div class="dashboard-card-regular">
        <h3 class="title subheader">Urgency of Tasks</h3>
        <%= pie_chart Task.group(:urgency).count, messages: {empty: "No data"}, library:{backgroundColor: "#FFFFFF"},width: "250px", height: "230px"  %>
          <!-- messages: {empty: "No data"}, library:{backgroundColor: "#FFFFFF"},width: "300px", height: "230px" -->
      </div>
    </div>
  </div>
</div>
